/*
 * utility.h
 *
 *  Created on: Sep 1, 2023
 *      Author: tjp
 */

#ifndef INC_UTILITY_H_
#define INC_UTILITY_H_
#define ON(PIN) HAL_GPIO_WritePin(PIN ## _GPIO_Port, PIN ## _Pin, GPIO_PIN_SET)
#define OFF(PIN) HAL_GPIO_WritePin(PIN ## _GPIO_Port, PIN ## _Pin, GPIO_PIN_RESET)
#define TOGGLE(PIN) HAL_GPIO_TogglePin(PIN ## _GPIO_Port, PIN ## _Pin)
#define SHORT_TIMEOUT 10
int echo_u1(uint8_t escape_char);
void test_leds(void);
int echo_u1(uint8_t escape_char){
	uint8_t karcsi=' ';
	int counter=0;
	while(!(karcsi==escape_char)){
	        if (HAL_UART_Receive(&huart1, (uint8_t *)&karcsi, 1, SHORT_TIMEOUT) == HAL_OK) {
	            // Echo the received character back
	            HAL_UART_Transmit(&huart1, (uint8_t *)&karcsi, 1, HAL_MAX_DELAY);
	            TOGGLE(BLUE1);
	            counter++;
	        }
	}
	return counter;
}

void test_leds(){
	ON(RED);
	HAL_Delay(100);
	ON(GREEN);
	HAL_Delay(100);
	ON(BLUE1);
	HAL_Delay(100);
	ON(BLUE2);
	HAL_Delay(100);
	ON(BLUE3);
	HAL_Delay(100);
	OFF(GREEN);
	HAL_Delay(100);
	ON(GREEN);
	HAL_Delay(100);
	ON(BLUE1);
	HAL_Delay(100);
	ON(BLUE2);
	HAL_Delay(100);
	ON(BLUE3);
	HAL_Delay(100);

}




#endif /* INC_UTILITY_H_ */
